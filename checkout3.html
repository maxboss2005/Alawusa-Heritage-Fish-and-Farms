<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout | Alawusa Heritage Fish & Farms</title>
  <link rel="shortcut icon" href="Alawusa heritage icon - Icon.png" type="img">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Modern E-commerce Variables */
    :root {
      --primary-color: #1a4d2e;
      --secondary-color: #28a745;
      --accent-color: #ffc107;
      --light-bg: #f9f9f9;
      --dark-text: #333;
      --light-text: #fff;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      color: #333;
    }
    
    .container-1 {
      max-width: 550px;
      margin: 50px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    h1 {
      text-align: center;
      color: #222;
      margin-bottom: 10px;
    }
    
    p {
      font-size: 15px;
      line-height: 1.6;
      text-align: center;
      color: #555;
    }
    
    .bank-details {
      margin-top: 25px;
      padding: 20px;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .bank-details strong {
      color: #000;
    }
    
    .copy-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 8px 14px;
      background: #fff;
      color: rgb(10, 10, 10);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      border: 1px solid black;
    }
    
    .copy-btn:hover {
      background: #bdbfc0;
    }
    
    .whatsapp-btn {
      display: block;
      text-align: center;
      margin-top: 25px;
      padding: 12px;
      background: #25d366;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 15px;
    }
    
    .whatsapp-btn:hover {
      background: #1ebc57;
    }
    
    .back-btn {
      display: block;
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      background: #555;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 14px;
    }
    
    .back-btn:hover {
      background: #333;
    }
    
    .shop-btn {
      display: block;
      text-align: center;
      margin-top: 25px;
      padding: 12px;
      background: #666;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 15px;
    }
    
    .shop-btn:hover {
      background: #444;
    }
    
    .amount {
      font-size: 18px;
      font-weight: bold;
      margin-top: 15px;
      color: #111;
    }
    
    .form-group {
      margin-top: 15px;
    }
    
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    
    .optional {
      color: #666;
      font-size: 0.85em;
      margin-top: 5px;
    }

    /* Payment proof preview styles */
    .proof-preview {
      display: none;
      margin-top: 10px;
      text-align: center;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    
    .proof-preview.show {
      display: block;
    }
    
    .proof-preview img {
      max-width: 200px;
      max-height: 200px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    
    .proof-filename {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .remove-proof {
      background: #ff4444;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }
    
    .remove-proof:hover {
      background: #cc0000;
    }

    /* Loading spinner */
    .loading {
      display: none;
      text-align: center;
      margin: 15px 0;
    }
    
    .loading.show {
      display: block;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #25d366;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Alert boxes */
    .info-box {
      background: #e8f4fc;
      border-left: 4px solid #2196f3;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 13px;
    }
    
    .info-box i {
      color: #2196f3;
      margin-right: 8px;
    }
    
    .alert-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 13px;
      display: none;
    }
    
    .alert-box.show {
      display: block;
    }
    
    .alert-box i {
      color: #856404;
      margin-right: 8px;
    }
    
    .success-box {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 13px;
      display: none;
    }
    
    .success-box.show {
      display: block;
    }
    
    .success-box i {
      color: #155724;
      margin-right: 8px;
    }

    /* Close button */
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 22px;
      font-weight: bold;
      color: #666;
      cursor: pointer;
      transition: color 0.3s;
    }
    
    .close-btn:hover {
      color: #000;
    }

    /* Desktop navbar */
    .navbar ul {
      display: flex;
      gap: 20px;
      list-style: none;
      margin: 0;
      padding: 0;
      background: none;
      margin-left: 210px;
      margin-top: 10px;
    }

    .navbar ul li a {
      text-decoration: none;
      font-weight: bold;
      color: #555;
      transition: color 0.3s;
      margin: 0 -100px;
      text-align: center;
      font-size: 20px;
    }

    .navbar ul li a:hover {
      color: #15921b;
    }

    /* Mobile menu styles */
    .menu-icon {
      display: none;
    }

    .mobile-menu {
      position: fixed;
      top: 0;
      right: -250px;
      width: 250px;
      height: 100%;
      background: rgb(4, 49, 12);
      box-shadow: -2px 0 10px rgba(0,0,0,0.2);
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 2000;
    }

    .mobile-menu.open {
      right: 0;
    }

    .mobile-menu .close-btn {
      background: none;
      border: none;
      font-size: 28px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      display: block;
      margin-left: auto;
    }

    .mobile-menu ul {
      list-style: none;
      padding: 20px 0 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .mobile-menu ul li a {
      text-decoration: none;
      color: #f5f3f3;
      font-weight: bold;
      font-size: 20px;
      padding: 10px;
      border-radius: 6px;
      transition: background 0.3s;
      line-height: 3.5;
    }

    .mobile-menu ul li a:hover {
      background: #f0f0f0;
      color: #218838;
    }

    /* Responsive behavior */
    @media (max-width: 768px) {
      .desktop-nav {
        display: none;
      }
      
      .menu-icon {
        display: block;
      }
      
      .shopping-cart {
        margin-left: 150px;
      }
      
      .top-bar {
        font-size: 12px;
        color: #000;
      }
      
      .cart-count {
        background: red;
        color: white;
        padding: 2px 6px; 
        border-radius: 50%; 
        font-size: 12px;
        position: relative;
        top: -60px; 
        left: -10px;
        margin-left: 180px;
      }
      
      .address {
        display: none;
      }
      
      .container-1 {
        margin: 20px auto;
        padding: 20px;
      }
    }

    /* Sticky header */
    .main-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Top bar with contacts */
    .top-bar {
      background: #2e802e;
      color: white;
      padding: 5px 20px;
      font-size: 14px;
      text-align: center;
    }

    .contact-info span {
      margin: 0 10px;
    }

    /* Cart count badge */
    .cart-count {
      background: red;
      color: white;
      padding: 2px 6px; 
      border-radius: 50%; 
      font-size: 12px;
      position: relative; 
      top: -60px; 
      left: -10px;
    }

    .shopping-cart {
      margin-bottom: 40px;
    }

    @media (max-width: 768px) {
      .shopping-cart {
        margin-bottom: 20px;
      }
    }

    /* Currency buttons */
    .currency-btn {
      padding: 6px 14px;
      margin: 5px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
    }
    
    .currency-btn.active {
      background: #25d366;
      color: #fff;
      font-weight: bold;
    }

    /* Account box */
    .account-box {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      padding: 10px 14px;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 15px;
    }
    
    .account-box span {
      font-weight: 500;
      color: #222;
    }
    
    .account-box strong {
      color: #000;
      margin-left: 5px;
    }

    /* Footer */
    .footer {
      background: var(--primary-color);
      color: var(--light-text);
      padding: 60px 0 20px;
    }

    .footer-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 40px;
      margin-bottom: 40px;
    }

    .footer-col {
      flex: 1;
      min-width: 200px;
    }

    .footer-col h3 {
      font-size: 20px;
      margin-bottom: 20px;
      position: relative;
      padding-bottom: 10px;
    }

    .footer-col h3::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 50px;
      height: 2px;
      background: var(--secondary-color);
    }

    .footer-col ul {
      list-style: none;
    }

    .footer-col ul li {
      margin-bottom: 10px;
    }

    .footer-col ul li a {
      color: #ddd;
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-col ul li a:hover {
      color: var(--secondary-color);
      padding-left: 5px;
    }

    .social-links {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .social-links a {
      display: inline-block;
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .social-links a:hover {
      background: var(--secondary-color);
      transform: translateY(-3px);
    }

    .social-links img {
      width: 20px;
      height: 20px;
    }

    .copyright {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 14px;
      color: #aaa;
    }
  </style>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B2NQHJMLJ6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B2NQHJMLJ6');
  </script>
</head>
<body>

  <!-- Header Section -->
  <header class="main-header">
    
    
    <div class="header">
      <div class="logo">
        <a href="dashboard.html"><img src="Alawusa heritage logo.png" style="width: 100px;"></a>
      </div>

      <a href="cart.html">
        <img src="shopping-cart.png" width="30px" height="30px" class="shopping-cart">
        <span id="cart-count" class="cart-count">0</span>
      </a>
    </div>
  </header>

  <div class="container-1" id="head">
    <h1>Complete Your Payment</h1>
    <p>Please transfer the total amount to the bank account below:</p>

    <div class="bank-details">
      <strong>Account Name:</strong> ALAWUSA HERITAGE FISH And FARMS <br><br>
      <strong>Bank Name:</strong> Guaranty Trust Bank (GTB) <br><br>

      <!-- Domestic Transfer (Nigeria) -->
      <div style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #1a4d2e;">
        <strong style="color: #1a4d2e;">üá≥üá¨ For Domestic Transfers (Within Nigeria):</strong><br>
        <div class="account-box">
          <span>NGN (Naira): <strong id="nairaAcc">3002053057</strong></span>
          <button class="copy-btn" onclick="copyAcc('nairaAcc')">Copy</button>
        </div>
      </div>

      <!-- International Transfer -->
      <div style="margin-bottom: 20px; padding: 15px; background: #fff8f0; border-radius: 8px; border-left: 4px solid #ff6b00;">
        <strong style="color: #ff6b00;">For International Transfers:</strong><br><br>
        
        <strong>Bank Codes Required:</strong><br>
        <div class="account-box">
          <span>SWIFT/BIC Code: <strong id="swiftCode">GTBINGLA</strong></span>
          <button class="copy-btn" onclick="copyAcc('swiftCode')">Copy</button>
        </div>
        <div class="account-box">
          <span>Sort Code: <strong id="sortCode">058-152146</strong></span>
          <button class="copy-btn" onclick="copyAcc('sortCode')">Copy</button>
        </div>
        <br>
        
        <strong>Foreign Currency Accounts:</strong><br>
        <div class="account-box">
          <span>üá∫üá∏ USD (Dollar): <strong id="usdAcc">3002053215</strong></span>
          <button class="copy-btn" onclick="copyAcc('usdAcc')">Copy</button>
        </div>
        <div class="account-box">
          <span>üá¨üáß GBP (Pounds): <strong id="gbpAcc">3002053071</strong></span>
          <button class="copy-btn" onclick="copyAcc('gbpAcc')">Copy</button>
        </div>
        <div class="account-box">
          <span>üá™üá∫ EUR (Euro): <strong id="eurAcc">3002053095</strong></span>
          <button class="copy-btn" onclick="copyAcc('eurAcc')">Copy</button>
        </div>
      </div>

      <div class="amount">Amount: <span id="totalAmount">‚Ç¶0</span></div>
    </div>

    <!-- Currency Selector -->
    <div style="margin-top: 15px;">
      <strong>Select Currency:</strong><br>
      <button type="button" class="currency-btn" onclick="setCurrency(event, 'NGN')">‚Ç¶ NGN</button>
      <button type="button" class="currency-btn" onclick="setCurrency(event, 'USD')">$ USD</button>
      <button type="button" class="currency-btn" onclick="setCurrency(event, 'GBP')">¬£ GBP</button>
      <button type="button" class="currency-btn" onclick="setCurrency(event, 'EUR')">‚Ç¨ EUR</button>
    </div>

    <!-- Instructions Section -->
    <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; font-size: 14px;">
      <strong>Important Transfer Instructions:</strong>
      <ul style="margin: 10px 0; padding-left: 20px;">
        <li>For <strong>Nigerian transfers</strong>, use only the Naira account number</li>
        <li>For <strong>international transfers</strong>, you MUST provide:
          <ul>
            <li>SWIFT/BIC Code: <strong>GTBINGLA</strong></li>
            <li>Sort Code: <strong>058-152146</strong></li>
            <li>The correct currency account (USD, GBP, or EUR)</li>
          </ul>
        </li>
        <li>Ensure the account name matches exactly: <strong>ALAWUSA HERITAGE FISH And FARMS</strong></li>
        <li>Transfer the exact amount shown above</li>
      </ul>
    </div>

    <!-- Upload Proof -->
    <div class="form-group">
      <label>Upload Payment Proof (receipt) - Image only (JPEG, PNG, GIF, WebP)</label>
      <input type="file" id="paymentProof" accept="image/*" onchange="previewProof(this)">
      <div class="info-box">
        <i class="fas fa-info-circle"></i>
        Please upload an image (screenshot or photo) of your payment receipt. 
        Max file size: 10MB.
      </div>
      <div class="proof-preview" id="proofPreview">
        <img id="proofImage" src="" alt="Payment Proof Preview">
        <div class="proof-filename" id="proofFilename"></div>
        <button class="remove-proof" onclick="removeProof()">Remove</button>
      </div>
      
      <div class="alert-box" id="uploadAlert">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="alertText"></span>
      </div>
      
      <div class="success-box" id="uploadSuccess">
        <i class="fas fa-check-circle"></i>
        <span id="successText"></span>
      </div>
    </div>

    <!-- Loading indicator -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p id="loadingText">Processing your order...</p>
    </div>

    <!-- Customer Details -->
    <div class="form-group">
      <label>Full Name</label>
      <input type="text" id="customerName" placeholder="Enter your full name">
    </div>
    
    <div class="form-group">
      <label>Email <span class="optional">(optional)</span></label>
      <input type="text" id="customerEmail" placeholder="Enter your email address">
    </div>
    
    <div class="form-group">
      <label>Phone Number</label>
      <input type="text" id="customerPhone" placeholder="Phone Number. Start with country code e.g +234">
    </div>
    
    <div class="form-group">
      <label>Delivery Address</label>
      <textarea id="customerAddress" placeholder="Enter your delivery address"></textarea>
    </div>

    <a id="whatsappLink" class="whatsapp-btn" onclick="sendWhatsApp()">
      <i class="fab fa-whatsapp"></i> Send Payment Proof via WhatsApp
    </a>
    
    <a href="dashboard.html" class="back-btn">‚Üê Back to Home</a>
    <a href="products.html" class="shop-btn">Continue Shopping</a>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-container">
        <div class="footer-col">
          <a href="dashboard.html"><img src="Alawusa heritage logo.png" alt="Alawusa Heritage" style="width: 200px; filter: brightness(2) invert(0);"></a>
          <p>Bringing the Best of Our Farm to Your Table</p>
          
          <div class="social-links">
            <a href="https://www.facebook.com/profile.php?id=61577588632364&mibextid=ZbWKwL"><img src="facebook.png" alt="Facebook"></a>
            <a href="https://www.instagram.com/alawusaheritage?igsh=MXJnbHJ5dGtlOGs0eQ=="><img src="instagram.png" alt="Instagram"></a>
            <a href="https://wa.link/zp8ngg"><img src="whatsapp.png" alt="WhatsApp"></a>
          </div>
        </div>
        
        <div class="footer-col">
          <h3>Customer Service</h3>
          <ul>
            <li><a href="faq.html">FAQs</a></li>
            <li><a href="contact.html">Contact Us</a></li>
          </ul>
        </div>
        
        <div class="footer-col">
          <h3>Useful Links</h3>
          <ul>
            <li><a href="blogpost.html">Farm Tips/Blog Post</a></li>
            <li><a href="ourfarm.html">Our Farm/Sustainability</a></li>
            <li><a href="recipes.html">Recipes</a></li>
            <li><a href="aboutus.html">About Us</a></li>
            <li><a href="testimonial.html">Reviews</a></li>
          </ul>
        </div>
        
        <div class="footer-col">
          <h3>Contact Info</h3>
          <ul>
            <li><i class="fas fa-phone"></i> +234-802-227-6254</li>
            <li><i class="fas fa-envelope"></i> alawusaheritage@gmail.com</li>
            <li><i class="fas fa-map-marker-alt"></i> Alawusa-House, Hungotho, Tube, Ipokia LG, Ogun State</li>
          </ul>
        </div>
      </div>
      
      <div class="copyright">
        <p>&copy; 2025 Alawusa Heritage Fish & Farms. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // --- INITIAL SETUP ---
    const total = parseFloat(localStorage.getItem('checkoutTotal') || 0);
    document.getElementById('totalAmount').innerText = `‚Ç¶${total.toLocaleString()}`;
    
    let currentCurrency = "NGN";
    let paymentProofFile = null;
    
    // Exchange rates (with fallback values)
    let exchangeRates = { 
      NGN: 1, 
      USD: 0.00069, 
      GBP: 0.00053, 
      EUR: 0.00060 
    };

    // --- CART COUNT ---
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
      const cartCount = document.getElementById('cart-count');
      if (cartCount) {
        cartCount.textContent = totalItems;
      }
    }

    // --- COPY FUNCTION ---
    function copyAcc(id) {
      const accNumber = document.getElementById(id).innerText;
      navigator.clipboard.writeText(accNumber).then(() => {
        alert(`Copied!`);
      });
    }

    // --- CURRENCY FUNCTIONS ---
    async function fetchExchangeRates() {
      try {
        const response = await fetch('https://api.frankfurter.app/latest?from=NGN&to=USD,GBP,EUR');
        const data = await response.json();
        
        if (data && data.rates) {
          exchangeRates = {
            NGN: 1,
            USD: data.rates.USD || 0.00069,
            GBP: data.rates.GBP || 0.00053,
            EUR: data.rates.EUR || 0.00060
          };
          
          // Update display if currency is already selected
          if (currentCurrency !== 'NGN') {
            updateCurrencyDisplay();
          }
        }
      } catch (error) {
        console.error('Failed to fetch live rates, using fallback:', error);
      }
    }

    function setCurrency(event, currency) {
      currentCurrency = currency;
      document.querySelectorAll(".currency-btn").forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
      updateCurrencyDisplay();
    }

    function updateCurrencyDisplay() {
      const total = parseFloat(localStorage.getItem('checkoutTotal') || 0);
      let converted = total * exchangeRates[currentCurrency];
      let symbol = "";
      
      if (currentCurrency === "NGN") symbol = "‚Ç¶";
      else if (currentCurrency === "USD") symbol = "$";
      else if (currentCurrency === "GBP") symbol = "¬£";
      else if (currentCurrency === "EUR") symbol = "‚Ç¨";
      
      document.getElementById("totalAmount").innerText = `${symbol}${converted.toFixed(2)}`;
    }

    // --- PAYMENT PROOF PREVIEW ---
    function previewProof(input) {
      const preview = document.getElementById('proofPreview');
      const image = document.getElementById('proofImage');
      const filename = document.getElementById('proofFilename');
      const file = input.files[0];
      
      if (file) {
        // Validate file size (10MB max)
        if (file.size > 10 * 1024 * 1024) {
          showAlert("File is too large! Please select an image under 10MB.");
          input.value = '';
          return;
        }
        
        // Validate file type
        if (!file.type.match('image.*')) {
          showAlert("Please upload an image file (JPEG, PNG, GIF). PDFs are not supported for WhatsApp.");
          input.value = '';
          return;
        }
        
        paymentProofFile = file;
        filename.textContent = file.name;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          image.src = e.target.result;
          preview.classList.add('show');
        };
        reader.readAsDataURL(file);
        
        hideAlerts();
      }
    }

    function removeProof() {
      const input = document.getElementById('paymentProof');
      const preview = document.getElementById('proofPreview');
      input.value = '';
      preview.classList.remove('show');
      paymentProofFile = null;
      hideAlerts();
    }

    // --- ALERT FUNCTIONS ---
    function showAlert(message) {
      const alertBox = document.getElementById('uploadAlert');
      const alertText = document.getElementById('alertText');
      alertText.textContent = message;
      alertBox.classList.add('show');
      
      const successBox = document.getElementById('uploadSuccess');
      successBox.classList.remove('show');
    }

    function showSuccess(message) {
      const successBox = document.getElementById('uploadSuccess');
      const successText = document.getElementById('successText');
      successText.textContent = message;
      successBox.classList.add('show');
      
      const alertBox = document.getElementById('uploadAlert');
      alertBox.classList.remove('show');
    }

    function hideAlerts() {
      document.getElementById('uploadAlert').classList.remove('show');
      document.getElementById('uploadSuccess').classList.remove('show');
    }

    // --- IMAGE UPLOAD FUNCTIONS ---
    async function uploadToImgBB(file) {
      // Use your ImgBB API key (free from https://api.imgbb.com/)
      const API_KEY = 'a8b84d52cca1215a026337ad4701bc1f';
      
      // Convert file to base64 string (remove data:image/... prefix)
      const base64Data = file.split(',')[1] || file;
      const formData = new FormData();
      formData.append('image', base64Data);
      
      const response = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (data.success) {
        return data.data.url; // Returns direct image URL
      } else {
        throw new Error(data.error?.message || 'Failed to upload image');
      }
    }

    async function uploadToCloudinary(file) {
      // Cloudinary settings
      const CLOUD_NAME = 'dmk7qtyky';
      const UPLOAD_PRESET = 'Alawusa Heritage Fish and Farms';
      
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', UPLOAD_PRESET);
      formData.append('cloud_name', CLOUD_NAME);
      
      const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (data.secure_url) {
        return data.secure_url; // Returns direct image URL
      } else {
        throw new Error(data.error?.message || 'Failed to upload image');
      }
    }

    async function uploadImageToFreeService(file) {
      // Convert file to base64 first
      const base64Data = await fileToBase64(file);
      
      let imageUrl = null;
      let serviceUsed = '';
      
      // Try Cloudinary first
      try {
        document.getElementById('loadingText').textContent = 'Uploading image...';
        imageUrl = await uploadToCloudinary(file);
        serviceUsed = 'Cloudinary';
        console.log("Uploaded to Cloudinary:", imageUrl);
        return { url: imageUrl, service: serviceUsed };
      } catch (error1) {
        console.warn("Cloudinary failed:", error1);
        
        // Try ImgBB as fallback
        try {
          document.getElementById('loadingText').textContent = 'Uploading image again...';
          imageUrl = await uploadToImgBB(base64Data);
          serviceUsed = 'ImgBB';
          console.log("Uploaded to ImgBB:", imageUrl);
          return { url: imageUrl, service: serviceUsed };
        } catch (error2) {
          console.warn("ImgBB failed:", error2);
          
          // Last resort: Use base64 if small enough
          if (base64Data.length < 50000) { // Less than 50KB
            serviceUsed = 'Base64';
            return { url: base64Data, service: serviceUsed, isBase64: true };
          } else {
            throw new Error("All upload services failed. Image is too large for Base64.");
          }
        }
      }
    }

    // --- MAIN WHATSAPP FUNCTION ---
    async function sendWhatsApp() {
      let name = document.getElementById("customerName").value.trim();
      let phone = document.getElementById("customerPhone").value.trim();
      let email = document.getElementById("customerEmail").value.trim();
      let address = document.getElementById("customerAddress").value.trim();
      
      if (!name || !phone || !address) {
        showAlert("Please fill in all required details: Name, Phone, and Address.");
        return;
      }

      if (!paymentProofFile) {
        showAlert("Please upload your payment proof (receipt) before sending.");
        return;
      }

      // Show loading
      document.getElementById('loading').classList.add('show');
      document.getElementById('loadingText').textContent = 'Processing your order...';
      document.querySelector('.whatsapp-btn').style.opacity = '0.5';
      document.querySelector('.whatsapp-btn').style.pointerEvents = 'none';
      hideAlerts();

      try {
        // 1. Upload image to free service
        let uploadResult = null;
        try {
          uploadResult = await uploadImageToFreeService(paymentProofFile);
        } catch (uploadError) {
          console.warn("Image upload failed, continuing without image URL:", uploadError);
        }
        
        // 2. Convert file to base64 for Google Sheets backup
        const proofBase64 = await fileToBase64(paymentProofFile);
        
        // 3. Get cart details
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let total = parseFloat(localStorage.getItem('checkoutTotal') || 0);
        let converted = total * exchangeRates[currentCurrency];
        let symbol = currentCurrency === "NGN" ? "‚Ç¶" : 
                     currentCurrency === "USD" ? "$" : 
                     currentCurrency === "GBP" ? "¬£" : "‚Ç¨";

        let cartDetails = cart.length > 0 ? cart
          .map((item, index) =>
            `${index + 1}. ${item.name} (x${item.quantity}) - ‚Ç¶${item.price.toLocaleString()}`
          ).join("\n") : "No items in cart";

        let timestamp = new Date().toLocaleString();
        let orderId = 'ORD-' + Date.now();

        // 4. Save to Google Sheets
        let orderRows = cart.length > 0 ? cart.map((item, index) => ({
          Timestamp: index === 0 ? timestamp : "",
          Name: index === 0 ? name : "",
          Email: index === 0 ? email : "",
          Phone: index === 0 ? phone : "",
          Address: index === 0 ? address : "",
          Currency: currentCurrency,
          Product: item.name,
          Quantity: item.quantity,
          Price: item.price,
          ItemTotal: item.quantity * item.price,
          OrderTotal: index === 0 ? converted : "",
          OrderID: index === 0 ? orderId : "",
          ProofURL: index === 0 ? (uploadResult?.url || "Upload failed") : "",
          ProofService: index === 0 ? (uploadResult?.service || "None") : "",
          ProofBase64: index === 0 ? (uploadResult?.isBase64 ? "Yes" : proofBase64.substring(0, 100) + "...") : "",
        })) : [{
          Timestamp: timestamp,
          Name: name,
          Email: email,
          Phone: phone,
          Address: address,
          Currency: currentCurrency,
          Product: "Empty Cart",
          Quantity: 0,
          Price: 0,
          ItemTotal: 0,
          OrderTotal: converted,
          OrderID: orderId,
          ProofURL: uploadResult?.url || "Upload failed",
          ProofService: uploadResult?.service || "None",
          ProofBase64: uploadResult?.isBase64 ? "Yes" : proofBase64.substring(0, 100) + "...",
        }];

        // Send to Google Sheets
        await fetch("https://sheetdb.io/api/v1/supulk4c3weec", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ data: orderRows })
        });

        // 5. Clear cart
        localStorage.removeItem("cart");
        localStorage.removeItem("checkoutTotal");

        // 6. Prepare WhatsApp message
        const whatsappNumber = "2348022276254";
        let proofMessage = "";
        
        if (uploadResult) {
          if (uploadResult.isBase64) {
            proofMessage = `üì∏ Payment proof attached as Base64 image`;
          } else {
            proofMessage = `üì∏ Payment proof: ${uploadResult.url}`;
          }
        } else {
          proofMessage = `üì∏ Payment proof saved in order database`;
        }

        const message = `*NEW ORDER - ${orderId}* üìã

*Customer Information:*
üë§ Name: ${name}
üìû Phone: ${phone}
üìß Email: ${email || 'Not provided'}
üìç Address: ${address}

*Order Summary:*
${cartDetails}

*Payment Details:*
üí∞ Amount Paid: ${symbol}${converted.toLocaleString()}
üí± Currency: ${currentCurrency}
üè¶ Bank: Guaranty Trust Bank (GTB)
üë• Account Name: ALAWUSA HERITAGE FISH And FARMS
üìÖ Date: ${new Date().toLocaleDateString()}
‚è∞ Time: ${new Date().toLocaleTimeString()}

*Payment Proof:*
${proofMessage}

*Account Information Used:*
‚Ä¢ For Nigerian transfers: NGN Account: 3002053057
‚Ä¢ For international transfers: Use SWIFT: GTBINGLA, Sort Code: 058-152146

*Order Status:* ‚è≥ Pending Verification

*Instructions:*
1. Verify payment in bank account
2. Check payment proof
3. Confirm order details
4. Proceed with order fulfillment`;

        // 7. Open WhatsApp
        const encodedMessage = encodeURIComponent(message);
        window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, "_blank");

        // 8. Show success message
        showSuccess(`‚úÖ Order submitted successfully! Order ID: ${orderId}`);
        
        // Additional alert
        setTimeout(() => {
          if (uploadResult?.url && !uploadResult.isBase64) {
            alert(`‚úÖ ORDER CONFIRMED!\n\nOrder ID: ${orderId}\n\nYour cart has been cleared.`);
          } else {
            alert(`‚úÖ ORDER CONFIRMED!\n\nOrder ID: ${orderId}\n\nYour cart has been cleared.`);
          }
        }, 500);

        // 9. Send email copy if email provided
        if (email) {
          sendOrderEmail(
            name,
            email,
            phone,
            address,
            cartDetails,
            `${symbol}${converted.toLocaleString()}`,
            orderId,
            uploadResult?.url
          );
        }

        // 10. Update cart count
        updateCartCount();

      } catch (err) {
        console.error("Full error:", err);
        showAlert(`Error: ${err.message || "Please try again. If problem persists, take a screenshot and send manually to WhatsApp."}`);
      } finally {
        // Hide loading
        document.getElementById('loading').classList.remove('show');
        document.querySelector('.whatsapp-btn').style.opacity = '1';
        document.querySelector('.whatsapp-btn').style.pointerEvents = 'auto';
      }
    }

    // --- HELPER FUNCTIONS ---
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = err => reject(err);
        reader.readAsDataURL(file);
      });
    }

    // --- INITIALIZE PAGE ---
    window.onload = function() {
      updateCartCount();
      fetchExchangeRates();
      
      // Update exchange rates every 5 minutes
      setInterval(fetchExchangeRates, 5 * 60 * 1000);
    };
  </script>

  <!-- Menu Toggle Script -->
  <script>
    function openMenu() {
      document.getElementById('mobileMenu').classList.add('open');
    }

    function closeMenu() {
      document.getElementById('mobileMenu').classList.remove('open');
    }

    // Accordion functionality
    document.querySelectorAll(".accordion-toggle").forEach(button => {
      button.addEventListener("click", () => {
        const content = button.nextElementSibling;

        // Close all other accordions
        document.querySelectorAll(".accordion-content").forEach(menu => {
          if (menu !== content) {
            menu.style.maxHeight = null;
            menu.previousElementSibling.classList.remove("active");
          }
        });

        // Toggle this one
        if (content.style.maxHeight) {
          content.style.maxHeight = null;
          button.classList.remove("active");
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
          button.classList.add("active");
        }
      });
    });
  </script>

  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function () {
        emailjs.init("5y1IrOU5yKY4zKpua");
      })();

      function sendOrderEmail(name, email, phone, address, cartDetails, totalAmount, orderId, proofUrl) {
    // Create HTML display for payment proof
    let paymentProofDisplay = '';
    
    if (proofUrl) {
        // Check if it's a base64 image or a URL
        if (proofUrl.startsWith('data:image')) {
            // For base64 images, embed directly
            paymentProofDisplay = `
                <img src="${proofUrl}" 
                     alt="Payment Proof" 
                     class="proof-image"
                     style="max-width: 100%; max-height: 300px; border: 1px solid #ddd; border-radius: 8px;">
                <p><small>Payment proof attached as image</small></p>
            `;
        } else {
            // For URL images, use the URL as image source
            paymentProofDisplay = `Click to open: ${proofUrl} 
            `;
        }
    } else {
        paymentProofDisplay = 'No payment proof uploaded.';
    }
    
    // Format cart details nicely with HTML
    let formattedCartDetails = '';
    if (cartDetails && cartDetails !== "No items in cart") {
        const lines = cartDetails.split('\n');
        formattedCartDetails = lines.map(line => {
            // Extract product name, quantity, and price
            const match = line.match(/(\d+)\.\s*(.+?)\s*\(x(\d+)\)\s*-\s*‚Ç¶([\d,]+)/);
            if (match) {
                const [, number, product, quantity, price] = match;
                return `${number}. ${product} (Quantity: ${quantity}) - ‚Ç¶${price}`;
            }
            return line;
        }).join('<br>');
    } else {
        formattedCartDetails = 'No items in cart';
    }

    let templateParams = {
        customer_name: name,
        customer_email: email,
        customer_phone: phone,
        customer_address: address,
        order_details: formattedCartDetails,
        total_amount: totalAmount,
        order_id: orderId || 'N/A',
        proof_url: proofUrl || '',
        payment_proof_display: paymentProofDisplay,
        date: new Date().toLocaleString()
    };

    console.log("Sending email with template params:", templateParams);

    emailjs.send("service_ez51nzf", "template_x8sz89f", templateParams)
        .then((response) => {
            console.log("‚úÖ Confirmation email sent!", response.status, response.text);
            showSuccess(`‚úÖ Order submitted! Confirmation email sent to ${email}`);
        })
        .catch((err) => {
            console.error("EmailJS Error:", err);
            // Don't show error to user if email fails - WhatsApp message is primary
            console.warn("Email sending failed, but order was still submitted via WhatsApp.");
        });
}
  </script>
</body>
</html>