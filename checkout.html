<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Checkout | Alawusa Heritage Fish & Farms</title>
    <link
      rel="shortcut icon"
      href="Alawusa heritage icon - Icon.png"
      type="img"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="shared-styles.css">
    <!-- PDF.js library for PDF to image conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    

    <style>
      /* Modern E-commerce Variables */
      :root {
        --primary-color: #1a4d2e;
        --secondary-color: #28a745;
        --accent-color: #ffc107;
        --light-bg: #f9f9f9;
        --dark-text: #333;
        --light-text: #fff;
        --border-radius: 8px;
        --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 0;
        color: #333;
      }

      .container-1 {
        max-width: 550px;
        margin: 50px auto;
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      h1 {
        text-align: center;
        color: #222;
        margin-bottom: 10px;
      }

      p {
        font-size: 15px;
        line-height: 1.6;
        text-align: center;
        color: #555;
      }

      .bank-details {
        margin-top: 25px;
        padding: 20px;
        background: #fafafa;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
      }

      .bank-details strong {
        color: #000;
      }

      .copy-btn {
        display: inline-block;
        margin-top: 8px;
        padding: 8px 14px;
        background: #fff;
        color: rgb(10, 10, 10);
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        border: 1px solid black;
      }

      .copy-btn:hover {
        background: #bdbfc0;
      }

      .whatsapp-btn {
        display: block;
        text-align: center;
        margin-top: 25px;
        padding: 12px;
        background: #25d366;
        color: white;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        font-size: 15px;
      }

      .whatsapp-btn:hover {
        background: #1ebc57;
      }

      .back-btn {
        display: block;
        text-align: center;
        margin-top: 15px;
        padding: 10px;
        background: #555;
        color: white;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
      }

      .back-btn:hover {
        background: #333;
      }

      .shop-btn {
        display: block;
        text-align: center;
        margin-top: 25px;
        padding: 12px;
        background: #666;
        color: white;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        font-size: 15px;
      }

      .shop-btn:hover {
        background: #444;
      }

      .amount {
        font-size: 18px;
        font-weight: bold;
        margin-top: 15px;
        color: #111;
      }

      .form-group {
        margin-top: 15px;
      }

      input,
      textarea {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      .optional {
        color: #666;
        font-size: 0.85em;
        margin-top: 5px;
      }

      /* Payment proof preview styles */
      .proof-preview {
        display: none;
        margin-top: 10px;
        text-align: center;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 8px;
        border: 1px solid #ddd;
      }

      .proof-preview.show {
        display: block;
      }

      .proof-preview img {
        max-width: 200px;
        max-height: 200px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      .proof-filename {
        font-size: 12px;
        color: #666;
        margin-bottom: 8px;
      }

      .remove-proof {
        background: #ff4444;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
      }

      .remove-proof:hover {
        background: #cc0000;
      }

      /* Loading spinner */
      .loading {
        display: none;
        text-align: center;
        margin: 15px 0;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #25d366;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Alert boxes */
      .info-box {
        background: #e8f4fc;
        border-left: 4px solid #2196f3;
        padding: 12px;
        margin: 10px 0;
        border-radius: 4px;
        font-size: 13px;
      }

      .info-box i {
        color: #2196f3;
        margin-right: 8px;
      }

      .alert-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 12px;
        margin: 10px 0;
        border-radius: 4px;
        font-size: 13px;
        display: none;
      }

      .alert-box.show {
        display: block;
      }

      .alert-box i {
        color: #856404;
        margin-right: 8px;
      }

      .success-box {
        background: #d4edda;
        border-left: 4px solid #28a745;
        padding: 12px;
        margin: 10px 0;
        border-radius: 4px;
        font-size: 13px;
        display: none;
      }

      .success-box.show {
        display: block;
      }

      .success-box i {
        color: #155724;
        margin-right: 8px;
      }

      /* Close button */
      .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 22px;
        font-weight: bold;
        color: #666;
        cursor: pointer;
        transition: color 0.3s;
      }

      .close-btn:hover {
        color: #000;
      }

      /* Desktop navbar */
      .navbar ul {
        display: flex;
        gap: 20px;
        list-style: none;
        margin: 0;
        padding: 0;
        background: none;
        margin-left: 210px;
        margin-top: 10px;
      }

      .navbar ul li a {
        text-decoration: none;
        font-weight: bold;
        color: #555;
        transition: color 0.3s;
        margin: 0 -100px;
        text-align: center;
        font-size: 20px;
      }

      .navbar ul li a:hover {
        color: #15921b;
      }

      /* Mobile menu styles */
      .menu-icon {
        display: none;
      }

      .mobile-menu {
        position: fixed;
        top: 0;
        right: -250px;
        width: 250px;
        height: 100%;
        background: rgb(4, 49, 12);
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
        padding: 20px;
        transition: right 0.3s ease;
        z-index: 2000;
      }

      .mobile-menu.open {
        right: 0;
      }

      .mobile-menu .close-btn {
        background: none;
        border: none;
        font-size: 28px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        display: block;
        margin-left: auto;
      }

      .mobile-menu ul {
        list-style: none;
        padding: 20px 0 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .mobile-menu ul li a {
        text-decoration: none;
        color: #f5f3f3;
        font-weight: bold;
        font-size: 20px;
        padding: 10px;
        border-radius: 6px;
        transition: background 0.3s;
        line-height: 3.5;
      }

      .mobile-menu ul li a:hover {
        background: #f0f0f0;
        color: #218838;
      }

      /* PDF Preview Styles */
      .pdf-preview-container {
        display: none;
        margin-top: 10px;
        text-align: center;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 8px;
        border: 1px solid #ddd;
      }

      .pdf-preview-container.show {
        display: block;
      }

      .pdf-preview-canvas {
        max-width: 200px;
        max-height: 200px;
        border-radius: 8px;
        border: 1px solid #ddd;
        background: white;
      }

      .pdf-page-info {
        font-size: 11px;
        color: #666;
        margin: 5px 0;
      }

      .pdf-navigation {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 10px 0;
      }

      .pdf-nav-btn {
        background: #4a6fa5;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
      }

      .pdf-nav-btn:hover:not(:disabled) {
        background: #3a5a8c;
      }

      .pdf-nav-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }

      /* Responsive behavior */
      @media (max-width: 768px) {
        .desktop-nav {
          display: none;
        }

        .menu-icon {
          display: block;
        }

        .shopping-cart {
          margin-left: 150px;
        }

        .top-bar {
          font-size: 12px;
          color: #000;
        }

        .cart-count {
          background: red;
          color: white;
          padding: 2px 6px;
          border-radius: 50%;
          font-size: 12px;
          position: relative;
          top: -60px;
          left: -10px;
          margin-left: 180px;
        }

        .address {
          display: none;
        }

        .container-1 {
          margin: 20px auto;
          padding: 20px;
        }
      }

      /* Sticky header */
      .main-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      /* Top bar with contacts */
      .top-bar {
        background: #2e802e;
        color: white;
        padding: 5px 20px;
        font-size: 14px;
        text-align: center;
      }

      .contact-info span {
        margin: 0 10px;
      }

      /* Cart count badge */
      .cart-count {
        background: red;
        color: white;
        padding: 2px 6px;
        border-radius: 50%;
        font-size: 12px;
        position: relative;
        top: -60px;
        left: -10px;
      }

      .shopping-cart {
        margin-bottom: 40px;
      }

      @media (max-width: 768px) {
        .shopping-cart {
          margin-bottom: 20px;
        }
      }

      /* Currency buttons */
      .currency-btn {
        padding: 6px 14px;
        margin: 5px;
        border: 1px solid #444;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
      }

      .currency-btn.active {
        background: #25d366;
        color: #fff;
        font-weight: bold;
      }

      /* Account box */
      .account-box {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9f9f9;
        padding: 10px 14px;
        margin-top: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 15px;
      }

      .account-box span {
        font-weight: 500;
        color: #222;
      }

      .account-box strong {
        color: #000;
        margin-left: 5px;
      }

      /* Footer */
      .footer {
        background: var(--primary-color);
        color: var(--light-text);
        padding: 60px 0 20px;
      }

      .footer-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 40px;
        margin-bottom: 40px;
      }

      .footer-col {
        flex: 1;
        min-width: 200px;
      }

      .footer-col h3 {
        font-size: 20px;
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
      }

      .footer-col h3::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 50px;
        height: 2px;
        background: var(--secondary-color);
      }

      .footer-col ul {
        list-style: none;
      }

      .footer-col ul li {
        margin-bottom: 10px;
      }

      .footer-col ul li a {
        color: #ddd;
        text-decoration: none;
        transition: var(--transition);
      }

      .footer-col ul li a:hover {
        color: var(--secondary-color);
        padding-left: 5px;
      }

      .social-links {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      .social-links a {
        display: inline-block;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .social-links a:hover {
        background: var(--secondary-color);
        transform: translateY(-3px);
      }

      .social-links img {
        width: 20px;
        height: 20px;
      }

      .copyright {
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 14px;
        color: #aaa;
      }
    </style>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-B2NQHJMLJ6"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-B2NQHJMLJ6");
    </script>
  </head>
  <body>
    <!-- Header Section -->
    <header class="main-header">
      <div class="header">
        <div class="logo">
          <a href="dashboard.html"
            ><img src="Alawusa heritage logo.png" style="width: 100px"
          /></a>
        </div>

        <a href="cart.html">
          <img
            src="shopping-cart.png"
            width="30px"
            height="30px"
            class="shopping-cart"
          />
          <span id="cart-count" class="cart-count">0</span>
        </a>
      </div>
    </header>

    <div class="container-1" id="head">
      <h1>Complete Your Payment</h1>
      <p>Please transfer the total amount to the bank account below:</p>

      <div class="bank-details">
        <strong>Account Name:</strong> ALAWUSA HERITAGE FISH And FARMS
        <br /><br />
        <strong>Bank Name:</strong> Guaranty Trust Bank (GTB) <br /><br />

        <!-- Domestic Transfer (Nigeria) -->
        <div
          style="
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid #1a4d2e;
          "
        >
          <strong style="color: #1a4d2e"
            >ðŸ‡³ðŸ‡¬ For Domestic Transfers (Within Nigeria):</strong
          ><br />
          <div class="account-box">
            <span>NGN (Naira): <strong id="nairaAcc">3002053057</strong></span>
            <button class="copy-btn" onclick="copyAcc('nairaAcc')">Copy</button>
          </div>
        </div>

        <!-- International Transfer -->
        <div
          style="
            margin-bottom: 20px;
            padding: 15px;
            background: #fff8f0;
            border-radius: 8px;
            border-left: 4px solid #ff6b00;
          "
        >
          <strong style="color: #ff6b00">For International Transfers:</strong
          ><br /><br />

          <strong>Bank Codes Required:</strong><br />
          <div class="account-box">
            <span
              >SWIFT/BIC Code: <strong id="swiftCode">GTBINGLA</strong></span
            >
            <button class="copy-btn" onclick="copyAcc('swiftCode')">
              Copy
            </button>
          </div>
          <div class="account-box">
            <span>Sort Code: <strong id="sortCode">058-152146</strong></span>
            <button class="copy-btn" onclick="copyAcc('sortCode')">Copy</button>
          </div>
          <br />

          <strong>Foreign Currency Accounts:</strong><br />
          <div class="account-box">
            <span
              >ðŸ‡ºðŸ‡¸ USD (Dollar): <strong id="usdAcc">3002053215</strong></span
            >
            <button class="copy-btn" onclick="copyAcc('usdAcc')">Copy</button>
          </div>
          <div class="account-box">
            <span
              >ðŸ‡¬ðŸ‡§ GBP (Pounds): <strong id="gbpAcc">3002053071</strong></span
            >
            <button class="copy-btn" onclick="copyAcc('gbpAcc')">Copy</button>
          </div>
          <div class="account-box">
            <span>ðŸ‡ªðŸ‡º EUR (Euro): <strong id="eurAcc">3002053095</strong></span>
            <button class="copy-btn" onclick="copyAcc('eurAcc')">Copy</button>
          </div>
        </div>

        <div class="amount">Amount: <span id="totalAmount">â‚¦0</span></div>
      </div>

      <!-- Currency Selector -->
      <div style="margin-top: 15px">
        <strong>Select Currency:</strong><br />
        <button
          type="button"
          class="currency-btn"
          onclick="setCurrency(event, 'NGN')"
        >
          â‚¦ NGN
        </button>
        <button
          type="button"
          class="currency-btn"
          onclick="setCurrency(event, 'USD')"
        >
          $ USD
        </button>
        <button
          type="button"
          class="currency-btn"
          onclick="setCurrency(event, 'GBP')"
        >
          Â£ GBP
        </button>
        <button
          type="button"
          class="currency-btn"
          onclick="setCurrency(event, 'EUR')"
        >
          â‚¬ EUR
        </button>
      </div>

      <!-- Instructions Section -->
      <div
        style="
          margin-top: 20px;
          padding: 15px;
          background: #f9f9f9;
          border-radius: 8px;
          font-size: 14px;
        "
      >
        <strong>Important Transfer Instructions:</strong>
        <ul style="margin: 10px 0; padding-left: 20px">
          <li>
            For <strong>Nigerian transfers</strong>, use only the Naira account
            number
          </li>
          <li>
            For <strong>international transfers</strong>, you MUST provide:
            <ul>
              <li>SWIFT/BIC Code: <strong>GTBINGLA</strong></li>
              <li>Sort Code: <strong>058-152146</strong></li>
              <li>The correct currency account (USD, GBP, or EUR)</li>
            </ul>
          </li>
          <li>
            Ensure the account name matches exactly:
            <strong>ALAWUSA HERITAGE FISH And FARMS</strong>
          </li>
          <li>Transfer the exact amount shown above</li>
        </ul>
      </div>

      <!-- Upload Proof -->
      <div class="form-group">
        <label
          >Upload Payment Proof (receipt) - PDF, JPEG, PNG, GIF, WebP</label
        >
        <input
          type="file"
          id="paymentProof"
          accept=".pdf,.jpg,.jpeg,.png,.gif,.webp,image/*"
          onchange="previewProof(this)"
        />
        <div class="info-box">
          <i class="fas fa-info-circle"></i>
          You can upload PDF files or images (screenshot or photo) of your
          payment receipt. Max file size: 10MB.
        </div>

        <!-- Image Preview -->
        <div class="proof-preview" id="proofPreview">
          <img id="proofImage" src="" alt="Payment Proof Preview" />
          <div class="proof-filename" id="proofFilename"></div>
          <button class="remove-proof" onclick="removeProof()">Remove</button>
        </div>

        <!-- PDF Preview -->
        <div class="pdf-preview-container" id="pdfPreview">
          <canvas id="pdfPreviewCanvas" class="pdf-preview-canvas"></canvas>
          <div class="pdf-page-info" id="pdfPageInfo"></div>
          <div class="pdf-navigation" id="pdfNavigation">
            <button
              class="pdf-nav-btn"
              onclick="changePdfPage(-1)"
              id="prevPageBtn"
              disabled
            >
              Previous
            </button>
            <button
              class="pdf-nav-btn"
              onclick="changePdfPage(1)"
              id="nextPageBtn"
              disabled
            >
              Next
            </button>
          </div>
          <div class="proof-filename" id="pdfFilename"></div>
          <button class="remove-proof" onclick="removeProof()">Remove</button>
        </div>

        <div class="alert-box" id="uploadAlert">
          <i class="fas fa-exclamation-triangle"></i>
          <span id="alertText"></span>
        </div>

        <div class="success-box" id="uploadSuccess">
          <i class="fas fa-check-circle"></i>
          <span id="successText"></span>
        </div>
      </div>

      <!-- Loading indicator -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p id="loadingText">Processing your order...</p>
      </div>

      <!-- Customer Details -->
      <div class="form-group">
        <label>Full Name</label>
        <input
          type="text"
          id="customerName"
          placeholder="Enter your full name"
        />
      </div>

      <div class="form-group">
        <label>Email <span class="optional">(optional)</span></label>
        <input
          type="text"
          id="customerEmail"
          placeholder="Enter your email address"
        />
      </div>

      <div class="form-group">
        <label>Phone Number</label>
        <input
          type="text"
          id="customerPhone"
          placeholder="Phone Number. Start with country code e.g +234"
        />
      </div>

      <div class="form-group">
        <label>Delivery Address</label>
        <textarea
          id="customerAddress"
          placeholder="Enter your delivery address"
        ></textarea>
      </div>

      <a id="whatsappLink" class="whatsapp-btn" onclick="sendWhatsApp()">
        <i class="fas fa-check"></i> Complete Order
      </a>
      <a href="userdashboard.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Home</a>
      <a href="userproducts.html" class="shop-btn"> <i class="fas fa-shop"></i> Continue Shopping</a>
      
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-container">
          <div class="footer-col">
            <a href="dashboard.html"
              ><img
                src="Alawusa heritage logo.png"
                alt="Alawusa Heritage"
                style="width: 200px; filter: brightness(2) invert(0)"
            /></a>
            <p>Bringing the Best of Our Farm to Your Table</p>

            <div class="social-links">
              <a
                href="https://www.facebook.com/profile.php?id=61577588632364&mibextid=ZbWKwL"
                ><img src="facebook.png" alt="Facebook"
              /></a>
              <a
                href="https://www.instagram.com/alawusaheritage?igsh=MXJnbHJ5dGtlOGs0eQ=="
                ><img src="instagram.png" alt="Instagram"
              /></a>
              <a href="https://wa.link/zp8ngg"
                ><img src="whatsapp.png" alt="WhatsApp"
              /></a>
            </div>
          </div>

          <div class="footer-col">
            <h3>Customer Service</h3>
            <ul>
              <li><a href="faq.html">FAQs</a></li>
              <li><a href="testimonial.html">Reviews</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>

          <div class="footer-col">
            <h3>Useful Links</h3>
            <ul>
              <li><a href="blogpost.html">Farm Tips/Blog Post</a></li>
              <li><a href="ourfarm.html">Our Farm/Sustainability</a></li>
              <li><a href="recipes.html">Recipes</a></li>
              <li><a href="aboutus.html">About Us</a></li>
              
            </ul>
          </div>

          <div class="footer-col">
            <h3>Contact Info</h3>
            <ul>
              <li><i class="fas fa-phone"></i> +234-802-227-6254</li>
              <li><i class="fas fa-envelope"></i> alawusaheritage@gmail.com</li>
              <li>
                <i class="fas fa-map-marker-alt"></i> Alawusa-House, Hungotho,
                Tube, Ipokia LG, Ogun State
              </li>
            </ul>
          </div>
        </div>

        <div class="copyright">
          <p>&copy; 2025 Alawusa Heritage Fish & Farms. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="shared.js"></script>
    <script>
      // --- PDF VARIABLES ---
      let pdfDocument = null;
      let pdfCurrentPage = 1;
      let pdfTotalPages = 1;
      let pdfImages = []; // Store converted PDF pages as images
      let paymentProofFile = null;
      let isPDF = false;


      // --- FIREBASE INITIALIZATION ---
let firebaseApp = null;
let firebaseDb = null;

async function initializeFirebase() {
  if (!firebaseApp) {
    try {
      const { initializeApp } = await import(
        "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"
      );
      const { getFirestore } = await import(
        "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"
      );

      const firebaseConfig = {
        apiKey: "AIzaSyDuxTHLfwiETTMO6Dx7YMehngZqWLgUlH0",
        authDomain: "alawusa-heritage-website.firebaseapp.com",
        projectId: "alawusa-heritage-website",
        storageBucket: "alawusa-heritage-website.firebasestorage.app",
        messagingSenderId: "857988164081",
        appId: "1:857988164081:web:ccac1200d344a8bd82bc50",
        measurementId: "G-TJQJMVVMZG",
      };

      firebaseApp = initializeApp(firebaseConfig);
      firebaseDb = getFirestore(firebaseApp);
      console.log("âœ… Firebase initialized successfully");
    } catch (firebaseError) {
      console.error("âŒ Firebase initialization failed:", firebaseError);
      throw firebaseError;
    }
  }
  return { app: firebaseApp, db: firebaseDb };
}

      // --- INITIAL SETUP ---
      const total = parseFloat(localStorage.getItem("checkoutTotal") || 0);
      document.getElementById(
        "totalAmount"
      ).innerText = `â‚¦${total.toLocaleString()}`;

      let currentCurrency = "NGN";

      // Exchange rates (with fallback values)
      let exchangeRates = {
        NGN: 1,
        USD: 0.00069,
        GBP: 0.00053,
        EUR: 0.0006,
      };

      // --- CART COUNT ---
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce(
          (sum, item) => sum + (item.quantity || 1),
          0
        );
        const cartCount = document.getElementById("cart-count");
        if (cartCount) {
          cartCount.textContent = totalItems;
        }
      }

      function copyAcc(id) {
    const acc = document.getElementById(id).innerText;
    const copyButton = event.target; // Get the button that was clicked
    
    // Save the original text
    const originalText = copyButton.textContent;
    
    navigator.clipboard.writeText(acc)
        .then(() => {
            // Change button text to "Copied"
            copyButton.textContent = "Copied!";
           
            
            
            copyButton.innerHTML = 'Copied!';
            
            // Reset button after 2 seconds
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.style.backgroundColor = "";
                copyButton.style.color = "";
                copyButton.style.borderColor = "";
                copyButton.innerHTML = originalText;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy: ', err);
            // Optional: Show error feedback
            copyButton.textContent = "Failed!";
            copyButton.style.backgroundColor = "#f44336";
            copyButton.style.color = "white";
            
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.style.backgroundColor = "";
                copyButton.style.color = "";
            }, 2000);
        });
}


      // --- CURRENCY FUNCTIONS ---
      async function fetchExchangeRates() {
        try {
          const response = await fetch(
            "https://api.frankfurter.app/latest?from=NGN&to=USD,GBP,EUR"
          );
          const data = await response.json();

          if (data && data.rates) {
            exchangeRates = {
              NGN: 1,
              USD: data.rates.USD || 0.00069,
              GBP: data.rates.GBP || 0.00053,
              EUR: data.rates.EUR || 0.0006,
            };

            // Update display if currency is already selected
            if (currentCurrency !== "NGN") {
              updateCurrencyDisplay();
            }
          }
        } catch (error) {
          console.error("Failed to fetch live rates, using fallback:", error);
        }
      }

      function setCurrency(event, currency) {
        currentCurrency = currency;
        document
          .querySelectorAll(".currency-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");
        updateCurrencyDisplay();
      }

      function updateCurrencyDisplay() {
        const total = parseFloat(localStorage.getItem("checkoutTotal") || 0);
        let converted = total * exchangeRates[currentCurrency];
        let symbol = "";

        if (currentCurrency === "NGN") symbol = "â‚¦";
        else if (currentCurrency === "USD") symbol = "$";
        else if (currentCurrency === "GBP") symbol = "Â£";
        else if (currentCurrency === "EUR") symbol = "â‚¬";

        document.getElementById(
          "totalAmount"
        ).innerText = `${symbol}${converted.toFixed(2)}`;
      }

      // --- PAYMENT PROOF PREVIEW ---
      async function previewProof(input) {
        const file = input.files[0];

        if (!file) {
          return;
        }

        // Validate file size (10MB max)
        if (file.size > 10 * 1024 * 1024) {
          showAlert("File is too large! Please select a file under 10MB.");
          input.value = "";
          return;
        }

        // Validate file type
        const validTypes = [
          "image/jpeg",
          "image/png",
          "image/gif",
          "image/webp",
          "application/pdf",
        ];
        if (!validTypes.includes(file.type)) {
          showAlert(
            "Please upload a valid file type: PDF, JPEG, PNG, GIF, or WebP."
          );
          input.value = "";
          return;
        }

        paymentProofFile = file;
        isPDF = file.type === "application/pdf";

        // Hide both previews initially
        document.getElementById("proofPreview").classList.remove("show");
        document.getElementById("pdfPreview").classList.remove("show");
        hideAlerts();

        if (isPDF) {
          // Handle PDF file
          await loadPDF(file);
        } else {
          // Handle image file
          previewImage(file);
        }
      }

      // --- IMAGE PREVIEW ---
      function previewImage(file) {
        const preview = document.getElementById("proofPreview");
        const image = document.getElementById("proofImage");
        const filename = document.getElementById("proofFilename");

        filename.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function (e) {
          image.src = e.target.result;
          preview.classList.add("show");
        };
        reader.readAsDataURL(file);
      }

      // --- PDF HANDLING FUNCTIONS ---
      async function loadPDF(file) {
        try {
          document.getElementById("loadingText").textContent = "Loading PDF...";
          document.getElementById("loading").classList.add("show");

          // Convert file to ArrayBuffer
          const arrayBuffer = await file.arrayBuffer();

          // Load PDF document
          const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
          pdfDocument = await loadingTask.promise;
          pdfTotalPages = pdfDocument.numPages;
          pdfCurrentPage = 1;
          pdfImages = []; // Clear previous images

          // Update UI
          document.getElementById("pdfFilename").textContent = file.name;
          document.getElementById(
            "pdfPageInfo"
          ).textContent = `Page 1 of ${pdfTotalPages}`;

          // Enable/disable navigation buttons
          document.getElementById("prevPageBtn").disabled = true;
          document.getElementById("nextPageBtn").disabled = pdfTotalPages <= 1;

          // Load first page
          await renderPDFPage();

          // Show PDF preview
          document.getElementById("pdfPreview").classList.add("show");
        } catch (error) {
          console.error("Error loading PDF:", error);
          showAlert(
            "Failed to load PDF file. Please try another file or convert to image."
          );
          removeProof();
        } finally {
          document.getElementById("loading").classList.remove("show");
        }
      }

      async function renderPDFPage() {
        if (!pdfDocument) return;

        try {
          const page = await pdfDocument.getPage(pdfCurrentPage);
          const canvas = document.getElementById("pdfPreviewCanvas");
          const context = canvas.getContext("2d");

          // Set canvas dimensions
          const viewport = page.getViewport({ scale: 0.5 });
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          // Render PDF page to canvas
          await page.render({
            canvasContext: context,
            viewport: viewport,
          }).promise;

          // Update page info
          document.getElementById(
            "pdfPageInfo"
          ).textContent = `Page ${pdfCurrentPage} of ${pdfTotalPages}`;

          // Update navigation buttons
          document.getElementById("prevPageBtn").disabled = pdfCurrentPage <= 1;
          document.getElementById("nextPageBtn").disabled =
            pdfCurrentPage >= pdfTotalPages;
        } catch (error) {
          console.error("Error rendering PDF page:", error);
        }
      }

      function changePdfPage(delta) {
        const newPage = pdfCurrentPage + delta;
        if (newPage >= 1 && newPage <= pdfTotalPages) {
          pdfCurrentPage = newPage;
          renderPDFPage();
        }
      }

      // --- CONVERT PDF TO IMAGE ---
      async function convertPDFToImages() {
        if (!pdfDocument || !isPDF) {
          return [];
        }

        const images = [];
        document.getElementById("loadingText").textContent =
          "Converting PDF to images...";

        try {
          // Convert each page to image
          for (let pageNum = 1; pageNum <= pdfTotalPages; pageNum++) {
            const page = await pdfDocument.getPage(pageNum);
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");

            // Use higher quality for actual conversion
            const viewport = page.getViewport({ scale: 2.0 });
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            await page.render({
              canvasContext: context,
              viewport: viewport,
            }).promise;

            // Convert canvas to data URL
            const imageData = canvas.toDataURL("image/jpeg", 0.8);
            images.push(imageData);
          }
        } catch (error) {
          console.error("Error converting PDF to images:", error);
          throw new Error("Failed to convert PDF to images");
        }

        return images;
      }

      // --- REMOVE PROOF ---
      function removeProof() {
        const input = document.getElementById("paymentProof");
        const imagePreview = document.getElementById("proofPreview");
        const pdfPreview = document.getElementById("pdfPreview");

        input.value = "";
        imagePreview.classList.remove("show");
        pdfPreview.classList.remove("show");

        // Clean up PDF resources
        if (pdfDocument) {
          pdfDocument.destroy();
          pdfDocument = null;
        }

        pdfImages = [];
        paymentProofFile = null;
        isPDF = false;

        hideAlerts();
      }

      // --- ALERT FUNCTIONS ---
      function showAlert(message) {
        const alertBox = document.getElementById("uploadAlert");
        const alertText = document.getElementById("alertText");
        alertText.textContent = message;
        alertBox.classList.add("show");

        const successBox = document.getElementById("uploadSuccess");
        successBox.classList.remove("show");
      }

      function showSuccess(message) {
        const successBox = document.getElementById("uploadSuccess");
        const successText = document.getElementById("successText");
        successText.textContent = message;
        successBox.classList.add("show");

        const alertBox = document.getElementById("uploadAlert");
        alertBox.classList.remove("show");
      }

      function hideAlerts() {
        document.getElementById("uploadAlert").classList.remove("show");
        document.getElementById("uploadSuccess").classList.remove("show");
      }

      // --- IMAGE UPLOAD FUNCTIONS ---
      async function uploadToImgBB(imageData) {
        // Remove data:image prefix if present
        const base64Data = imageData.includes("base64,")
          ? imageData.split(",")[1]
          : imageData;

        const formData = new FormData();
        formData.append("image", base64Data);

        // Using anonymous upload (images deleted after 1 hour)
        const response = await fetch(
          "https://api.imgbb.com/1/upload?key=free",
          {
            method: "POST",
            body: formData,
          }
        );

        const data = await response.json();

        if (data.success) {
          return data.data.url; // Returns direct image URL
        } else {
          throw new Error(data.error?.message || "Failed to upload image");
        }
      }

      async function uploadToCloudinary(file) {
        const CLOUD_NAME = "dmk7qtyky";
        const UPLOAD_PRESET = "Alawusa Heritage Fish and Farms";

        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", UPLOAD_PRESET);
        formData.append("cloud_name", CLOUD_NAME);

        const response = await fetch(
          `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
          {
            method: "POST",
            body: formData,
          }
        );

        const data = await response.json();

        if (data.secure_url) {
          return data.secure_url; // Returns direct image URL
        } else {
          throw new Error(data.error?.message || "Failed to upload image");
        }
      }

      // MAIN UPLOAD FUNCTION - tries multiple free services
      async function uploadImageToFreeService(file) {
        // For images, use the file directly
        // For PDFs, we need to convert to image first

        let fileToUpload = file;
        let isConvertedFromPDF = false;

        if (isPDF) {
          // Convert PDF to images
          document.getElementById("loadingText").textContent =
            "Converting PDF to images...";
          pdfImages = await convertPDFToImages();

          if (pdfImages.length === 0) {
            throw new Error("Failed to convert PDF to images");
          }

          // Use first page for upload (or you could upload all pages)
          fileToUpload = dataURLtoBlob(pdfImages[0]);
          isConvertedFromPDF = true;
        }

        // Try Cloudinary first
        try {
          document.getElementById("loadingText").textContent =
            "Uploading image...";
          const imageUrl = await uploadToCloudinary(fileToUpload);
          return { url: imageUrl, service: "Cloudinary" };
        } catch (error1) {
          console.warn("Cloudinary failed:", error1);

          // Try ImgBB as fallback
          try {
            document.getElementById("loadingText").textContent = "Uploading...";
            let imageUrl;

            if (isConvertedFromPDF) {
              // For converted PDF images, use base64 upload
              imageUrl = await uploadToImgBB(pdfImages[0]);
            } else {
              // For regular images, convert to base64 first
              const base64Data = await fileToBase64(fileToUpload);
              imageUrl = await uploadToImgBB(base64Data);
            }

            return { url: imageUrl, service: "ImgBB" };
          } catch (error2) {
            console.warn("ImgBB failed:", error2);

            // Last resort: Use data URL
            let dataUrl;
            if (isConvertedFromPDF) {
              dataUrl = pdfImages[0];
            } else {
              dataUrl = await fileToBase64(fileToUpload);
            }

            if (dataUrl.length < 100000) {
              // If less than 100KB
              return { url: dataUrl, service: "Base64", isBase64: true };
            } else {
              throw new Error("Upload failed. File is too large.");
            }
          }
        }
      }

      // --- MAIN WHATSAPP FUNCTION ---
      async function sendWhatsApp() {
        let name = document.getElementById("customerName").value.trim();
        let phone = document.getElementById("customerPhone").value.trim();
        let email = document.getElementById("customerEmail").value.trim();
        let address = document.getElementById("customerAddress").value.trim();

        if (!name || !phone || !address) {
          showAlert(
            "Please fill in all required details: Name, Phone, and Address."
          );
          return;
        }

        if (!paymentProofFile) {
          showAlert(
            "Please upload your payment proof (receipt) before sending."
          );
          return;
        }

        // Show loading
        document.getElementById("loading").classList.add("show");
        document.getElementById("loadingText").textContent =
          "Processing your order...";
        document.querySelector(".whatsapp-btn").style.opacity = "0.5";
        document.querySelector(".whatsapp-btn").style.pointerEvents = "none";
        hideAlerts();

        try {
          // 1. Upload file to free service
          let uploadResult = null;
          try {
            uploadResult = await uploadImageToFreeService(paymentProofFile);
          } catch (uploadError) {
            console.warn(
              "File upload failed, continuing without URL:",
              uploadError
            );
          }

          // 2. Get cart details
          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          let total = parseFloat(localStorage.getItem("checkoutTotal") || 0);
          let converted = total * exchangeRates[currentCurrency];
          let symbol = { NGN: "â‚¦", USD: "$", GBP: "Â£", EUR: "â‚¬" }[
            currentCurrency
          ];

          let cartDetails =
            cart.length > 0
              ? cart
                  .map(
                    (item, index) =>
                      `${index + 1}. ${item.name} (x${
                        item.quantity
                      }) - â‚¦${item.price.toLocaleString()}`
                  )
                  .join("\n")
              : "No items in cart";

          let timestamp = new Date().toLocaleString();
          let orderId = "ORD-" + Date.now();

          // In sendWhatsApp() function, replace the tracking token section with this:

          // 6. Save unregistered order to Firebase
// 6. Save unregistered order to Firebase
try {
  // Initialize Firebase first
  await initializeFirebase();
  const { doc, setDoc } = await import(
    "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"
  );

  // Log cart data for debugging
  console.log("Cart items before saving:", cart);
  console.log("Cart length:", cart.length);

  // Validate cart has items
  if (!cart || cart.length === 0) {
    console.error("Cart is empty, cannot save order to Firebase");
    throw new Error("Cart is empty");
  }

  // Prepare unregistered order data - FIXED to ensure proper data types
  const unregisteredOrder = {
    orderId: orderId || "",
    customerName: name || "",
    customerPhone: phone || "",
    customerEmail: email || "",
    customerAddress: address || "",
    items: cart.map((item) => ({
        productId: String(item.id || ""),
        productName: String(item.name || ""),
        price: Number(item.price || 0), // Original Naira price
        quantity: Number(item.quantity || 1),
        subtotal: Number((item.price || 0) * (item.quantity || 1)), // Naira subtotal
        image: String(item.img || ""),
    })),
    totalAmount: Number(converted || 0), // Amount in selected currency
    originalTotal: Number(total || 0), // Original amount in Naira
    currency: String(currentCurrency || "NGN"),
    exchangeRate: Number(exchangeRates[currentCurrency] || 1), // Save the exchange rate
    status: "awaiting_payment",
    paymentMethod: "bank_transfer",
    paymentProofUrl: String(uploadResult?.url || ""),
    paymentProofService: String(uploadResult?.service || ""),
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
    isUnregistered: true,
    source: "checkout_page"
  };

  console.log("Order data to save to Firebase:", unregisteredOrder);

  // Save to unregisteredOrders collection
  const unregisteredOrderRef = doc(firebaseDb, "unregisteredOrders", orderId);
  await setDoc(unregisteredOrderRef, unregisteredOrder);

  console.log("âœ… Unregistered order saved to Firebase:", orderId);
} catch (firebaseError) {
  console.error(
    "âŒ Error saving unregistered order to Firebase:",
    firebaseError
  );
  
  // Show a warning but continue
  showAlert(`Order submitted but could not save to database: ${firebaseError.message}. Your order ID is ${orderId}. Please save this ID for reference.`);
  
  // Continue anyway - localStorage will handle it
}

          // 7. Also save to localStorage as backup
          const unregisteredOrders = JSON.parse(
            localStorage.getItem("unregisteredOrders") || "[]"
          );
          unregisteredOrders.push({
            orderId: orderId,
            customerName: name,
            customerPhone: phone,
            customerEmail: email || "",
            customerAddress: address,
            totalAmount: converted,
            currency: currentCurrency,
            status: "awaiting_payment",
            createdAt: new Date().toISOString(),
          });
          localStorage.setItem(
            "unregisteredOrders",
            JSON.stringify(unregisteredOrders)
          );

          // 3. Save to Google Sheets
          let orderRows =
            cart.length > 0
              ? cart.map((item, index) => ({
                  Timestamp: index === 0 ? timestamp : "",
                  Name: index === 0 ? name : "",
                  Email: index === 0 ? email : "",
                  Phone: index === 0 ? phone : "",
                  Address: index === 0 ? address : "",
                  Currency: currentCurrency,
                  OrderID: index === 0 ? orderId : "",
                  ProofURL:
                    index === 0 ? uploadResult?.url || "Upload failed" : "",
                  Product: item.name,
                  Quantity: item.quantity,
                  Price: item.price,
                  ItemTotal: item.quantity * item.price,
                  OrderTotal: index === 0 ? converted : "",
                  FileType: isPDF ? "PDF" : "Image",
                  ProofService:
                    index === 0 ? uploadResult?.service || "None" : "",
                  ProofBase64:
                    index === 0
                      ? uploadResult?.isBase64
                        ? "Yes (Base64)"
                        : "URL provided"
                      : "",
                }))
              : [
                  {
                    Timestamp: timestamp,
                    Name: name,
                    Email: email,
                    Phone: phone,
                    Address: address,
                    Currency: currentCurrency,
                    OrderID: orderId,
                    ProofURL: uploadResult?.url || "Upload failed",
                    Product: "Empty Cart",
                    Quantity: 0,
                    Price: 0,
                    ItemTotal: 0,
                    OrderTotal: converted,
                    FileType: isPDF ? "PDF" : "Image",
                    ProofService: uploadResult?.service || "None",
                    ProofBase64: uploadResult?.isBase64
                      ? "Yes (Base64)"
                      : "URL provided",
                  },
                ];

          // Send to Google Sheets
          await fetch("https://sheetdb.io/api/v1/supulk4c3weec", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ data: orderRows }),
          });

          // 4. Clear cart
          localStorage.removeItem("cart");
          localStorage.removeItem("checkoutTotal");

          // 5. Prepare WhatsApp message
          const whatsappNumber = "2348022276254";
          let proofMessage = "";

          if (uploadResult) {
            if (uploadResult.isBase64) {
              proofMessage = `ðŸ“¸ Payment proof attached as Base64 image`;
            } else {
              proofMessage = `ðŸ“¸ Payment proof: ${uploadResult.url}`;
            }
          } else {
            proofMessage = `ðŸ“¸ Payment proof uploaded but link unavailable`;
          }

          const trackingMessage = `\n\n*Order Tracking:*\nYou can track your order status using:\nðŸ“± Phone: ${phone}\nðŸ“ Order ID: ${orderId}\nðŸ”— Link: ${window.location.origin}/track-order.html`;
          const message = `*NEW ORDER - ${orderId}* ðŸ“‹

*Customer Information:*
ðŸ‘¤ *Name:* ${name}
ðŸ“ž *Phone:* ${phone}
ðŸ“§ *Email:* ${email || "Not provided"}
ðŸ“ *Address:* ${address}

*Order Details:*
${cartDetails}

*Payment Information:*
ðŸ’° *Amount:* ${symbol}${converted.toLocaleString()}
ðŸ’± *Currency:* ${currentCurrency}
ðŸ“„ *File Type:* ${isPDF ? "PDF" : "Image"}
ðŸ¦ *Bank:* GTB
ðŸ‘¥ *Account Name:* ALAWUSA HERITAGE FISH And FARMS
ðŸ“… *Date/Time:* ${timestamp}

*Payment Proof:*
${proofMessage}


\n\n*Track Your Order:*\nðŸ”— ${
            window.location.origin
          }/track-order.html\nðŸ“± Phone: ${phone}\nðŸ“ Order ID: ${orderId}

*Instructions:*
1. Verify payment in bank account
2. Check payment proof ${uploadResult?.url ? `at: ${uploadResult.url}` : ""}
3. Confirm order details
4. Update order status
5. Arrange delivery`;

          // 6. Open WhatsApp
          const encodedMessage = encodeURIComponent(message);
          window.open(
            `https://wa.me/${whatsappNumber}?text=${encodedMessage}`,
            "_blank"
          );

          // 7. Show success message
          showSuccess(`âœ… Order submitted successfully! Order ID: ${orderId}`);

          // Additional alert
          // 7. Show success message and redirect
setTimeout(() => {
    const redirectUrl = `track-reminder.html?orderId=${encodeURIComponent(orderId)}&phone=${encodeURIComponent(phone)}&name=${encodeURIComponent(name)}&address=${encodeURIComponent(address)}&date=${encodeURIComponent(new Date().toLocaleString())}`;
    window.location.href = redirectUrl;
}, 1000);

          // 8. Send email copy if email provided
          if (email) {
            sendOrderEmail(
              name,
              email,
              phone,
              address,
              cartDetails,
              `${symbol}${converted.toLocaleString()}`,
              orderId,
              uploadResult?.url,
              isPDF
            );
          }

          // 9. Update cart count
          updateCartCount();
        } catch (err) {
          console.error("Full error:", err);
          showAlert(
            `Error: ${
              err.message ||
              "Please try again. If problem persists, take a screenshot and send manually to WhatsApp."
            }`
          );
        } finally {
          // Hide loading
          document.getElementById("loading").classList.remove("show");
          document.querySelector(".whatsapp-btn").style.opacity = "1";
          document.querySelector(".whatsapp-btn").style.pointerEvents = "auto";
        }
      }

      // --- HELPER FUNCTIONS ---
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = (err) => reject(err);
          reader.readAsDataURL(file);
        });
      }

      function dataURLtoBlob(dataURL) {
        const arr = dataURL.split(",");
        const mime = arr[0].match(/:(.*?);/)[1];
        const bstr = atob(arr[1]);
        let n = bstr.length;
        const u8arr = new Uint8Array(n);

        while (n--) {
          u8arr[n] = bstr.charCodeAt(n);
        }

        return new Blob([u8arr], { type: mime });
      }

      
      // --- INITIALIZE PAGE ---
window.onload = async function () {
  updateCartCount();
  fetchExchangeRates();

  // Initialize Firebase early
  try {
    await initializeFirebase();
    console.log("Firebase ready");
  } catch (error) {
    console.warn("Firebase initialization failed, will try later:", error);
  }

  // Update exchange rates every 5 minutes
  setInterval(fetchExchangeRates, 5 * 60 * 1000);
};
    </script>

    <!-- Menu Toggle Script -->
    <script>
      function openMenu() {
        document.getElementById("mobileMenu").classList.add("open");
      }

      function closeMenu() {
        document.getElementById("mobileMenu").classList.remove("open");
      }

      // Accordion functionality
      document.querySelectorAll(".accordion-toggle").forEach((button) => {
        button.addEventListener("click", () => {
          const content = button.nextElementSibling;

          // Close all other accordions
          document.querySelectorAll(".accordion-content").forEach((menu) => {
            if (menu !== content) {
              menu.style.maxHeight = null;
              menu.previousElementSibling.classList.remove("active");
            }
          });

          // Toggle this one
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            button.classList.remove("active");
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
            button.classList.add("active");
          }
        });
      });
    </script>

    <!-- EmailJS -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"
    ></script>
    <script>
      (function () {
        emailjs.init("5y1IrOU5yKY4zKpua");
      })();

      function sendOrderEmail(
        name,
        email,
        phone,
        address,
        cartDetails,
        totalAmount,
        orderId,
        proofUrl,
        isPDF
      ) {
        // Create HTML display for payment proof
        let paymentProofDisplay = "";
        let fileTypeInfo = isPDF ? " (PDF converted to image)" : "";

        if (proofUrl) {
          // Check if it's a base64 image or a URL
          if (proofUrl.startsWith("data:image")) {
            // For base64 images, embed directly
            paymentProofDisplay = `
                <img src="${proofUrl}" 
                     alt="Payment Proof${fileTypeInfo}" 
                     class="proof-image"
                     style="max-width: 100%; max-height: 300px; border: 1px solid #ddd; border-radius: 8px;">
                <p><small>Payment proof attached as image${fileTypeInfo}</small></p>
            `;
          } else {
            // For URL images, provide clickable link and image preview
            paymentProofDisplay = `Click the link to view Payment Proof. ${proofUrl}`;
          }
        } else {
          paymentProofDisplay = "No payment proof uploaded.";
        }

        // Format cart details nicely with HTML
        let formattedCartDetails = "";
        if (cartDetails && cartDetails !== "No items in cart") {
          const lines = cartDetails.split("\n");
          formattedCartDetails = lines
            .map((line) => {
              // Extract product name, quantity, and price
              const match = line.match(
                /(\d+)\.\s*(.+?)\s*\(x(\d+)\)\s*-\s*â‚¦([\d,]+)/
              );
              if (match) {
                const [, number, product, quantity, price] = match;
                return `${number}. ${product} (Quantity: ${quantity}) - â‚¦${price}`;
              }
              return line;
            })
            .join("<br>");
        } else {
          formattedCartDetails = "No items in cart";
        }

        let templateParams = {
          customer_name: name,
          customer_email: email,
          customer_phone: phone,
          customer_address: address,
          order_details: formattedCartDetails,
          total_amount: totalAmount,
          order_id: orderId || "N/A",
          proof_url: proofUrl || "",
          payment_proof_display: paymentProofDisplay,
          file_type_info: isPDF ? "PDF file converted to image" : "Image file",
          date: new Date().toLocaleString(),
        };

        console.log("Sending email with template params:", templateParams);

        emailjs
          .send("service_ez51nzf", "template_x8sz89f", templateParams)
          .then((response) => {
            console.log(
              "âœ… Confirmation email sent!",
              response.status,
              response.text
            );
            showSuccess(
              `âœ… Order submitted! Confirmation email sent to ${email}`
            );
          })
          .catch((err) => {
            console.error("EmailJS Error:", err);
            // Don't show error to user if email fails - WhatsApp message is primary
            console.warn(
              "Email sending failed, but order was still submitted via WhatsApp."
            );
          });
      }
    </script>
  </body>
</html>
